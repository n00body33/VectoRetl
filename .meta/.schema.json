{
  "$id": "https://raw.githubusercontent.com/timberio/vector/master/.meta/schema.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Vector Meta Schema",
  "type": "object",
  "required": [ "sinks" ],
  "properties": {
    "sinks": {
      "type": "object",
      "description": "Object of Vector sinks keyed by their ID",
      "patternProperties": {
        "^[a-z0-9_]+$": { "$ref": "#/definitions/sink" }
      }
    }
  },
  "definitions": {
    "option": {
      "type": "object",
      "additionalProperties": false,
      "required": ["description", "type"],
      "properties": {
        "category": {
          "type": "string"
        },
        "common": {
          "type": "boolean"
        },
        "default": {
        },
        "description": {
          "type": "string",
          "minLength": 10
        },
        "enum": {
          "type": "object",
          "patternProperties": {
            "^[a-z0-9_]+$": {
              "type": "string",
              "minLength": 10
            }
          }
        },
        "examples": {
          "type": "array"
        },
        "options": {
          "type": "object",
          "patternProperties": {
            "^[a-z0-9_]+$": { "$ref": "#/definitions/option" }
          }
        },
        "partition_key": {
          "type": "boolean"
        },
        "prioritize": {
          "type": "boolean"
        },
        "relevant_when": {
          "type": "object"
        },
        "required": {
          "type": "boolean"
        },
        "templateable": {
          "type": "boolean"
        },
        "type": {
          "type": "string",
          "enum": [
            "bool",
            "int",
            "string",
            "table",
            "[float]",
            "[string]"
          ]
        },
        "unit": {
          "type": "string",
          "enum": ["bytes", "milliseconds", "seconds"]
        }
      }
    },
    "output": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "examples": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["body", "label"],
            "properties": {
              "body": {
                "type": "string"
              },
              "label": {
                "type": "string"
              }
            }
          }
        }
      }
    },
    "sink": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "common",
        "delivery_guarantee",
        "egress_method",
        "function_category",
        "title",
        "write_to_description"
      ],
      "anyOf": [
        {
          "properties": {
            "egress_method": { "const": "batching" }
          },
          "required": [
            "batch_timeout_secs"
          ]
        },
        {
          "properties": {
            "egress_method": { "const": "exposing" }
          },
          "required": []
        },
        {
          "properties": {
            "egress_method": { "const": "streaming" }
          },
          "required": []
        }
      ],
      "properties": {
        "batch_is_common": {
          "type": "boolean"
        },
        "batch_max_events": {
          "type": "integer",
          "minimum": 1
        },
        "batch_max_size": {
          "type": "integer",
          "minimum": 1
        },
        "batch_timeout_secs": {
          "type": "integer",
          "minimum": 1
        },
        "beta": {
          "type": "boolean"
        },
        "buffer": {
          "type": "boolean"
        },
        "common": {
          "type": "boolean"
        },
        "compressions": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["gzip"]
          }
        },
        "delivery_guarantee": {
          "type": "string",
          "enum": ["at_least_once", "best_effort"]
        },
        "egress_method": {
          "type": "string",
          "enum": ["batching", "exposing", "streaming"]
        },
        "encodings": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["json", "ndjson", "text"]
          }
        },
        "env_vars": {
          "type": "object",
          "patternProperties": {
            "^[A-Z0-9_]+$": { "$ref": "#/definitions/option" }
          }
        },
        "function_category": {
          "type": "string",
          "enum": [
            "collect",
            "convert",
            "enrich",
            "filter",
            "parse",
            "program",
            "proxy",
            "receive",
            "sanitize",
            "shape",
            "test",
            "transmit"
          ]
        },
        "healthcheck": {
          "type": "boolean"
        },
        "input_types": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["log", "metric"]
          }
        },
        "options": {
          "type": "object",
          "patternProperties": {
            "^[a-z0-9_]+$": { "$ref": "#/definitions/option" }
          }
        },
        "output": { "$ref": "#/definitions/output" },
        "request_rate_limit_duration_secs": {
          "type": "integer",
          "minimum": 1
        },
        "request_rate_limit_num": {
          "type": "integer",
          "minimum": 1
        },
        "request_retry_attempts": {
          "type": "integer",
          "minimum": 1
        },
        "request_retry_initial_backoff_secs": {
          "type": "integer",
          "minimum": 1
        },
        "request_retry_max_duration_secs": {
          "type": "integer",
          "minimum": 1
        },
        "request_in_flight_limit": {
          "type": "integer",
          "minimum": 1
        },
        "request_timeout_secs": {
          "type": "integer",
          "minimum": 1
        },
        "service_limits_short_link": {
          "type": "string",
          "minLength": 1
        },
        "service_providers": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "AWS",
              "Confluent",
              "Datadog",
              "Elastic",
              "Google",
              "New Relic",
              "Splunk"
            ]
          }
        },
        "title": {
          "type": "string",
          "minLength": 1,
          "max_lenfth": 50
        },
        "tls_options": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["+enabled", "-verify"]
          }
        },
        "write_to_description": {
          "type": "string",
          "minLength": 5
        }
      }
    }
  }
}